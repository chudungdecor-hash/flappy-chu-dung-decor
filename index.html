<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Flappy Ch√∫ D≈©ng Decor</title>

<style>
  body{
    margin:0;
    background:#111;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:system-ui,-apple-system,Segoe UI,Roboto;
    user-select:none;
  }
  canvas{
    background:linear-gradient(#70c5ce,#b2dfdb);
    border-radius:14px;
  }
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  /* ========= LOGO (CHIM) =========
     üëâ THAY LINK LOGO C·ª¶A B·∫†N T·∫†I ƒê√ÇY
     (PNG n·ªÅn trong su·ªët s·∫Ω ƒë·∫πp nh·∫•t)
  */
  const logoImg = new Image();
  logoImg.src = "https://i.imgur.com/8QfQ9ZC.png"; // LOGO M·∫™U ‚Äì b·∫°n ƒë·ªïi sau

  const pipeImg = new Image();
  pipeImg.src =
    "https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/sprites/pipe-green.png";

  const sndFlap = new Audio("https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/audio/wing.wav");
  const sndPoint = new Audio("https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/audio/point.wav");
  const sndHit   = new Audio("https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/audio/hit.wav");

  sndFlap.volume  = 0.25;
  sndPoint.volume = 0.35;
  sndHit.volume   = 0.4;

  function playSound(a){
    try{ a.currentTime=0; a.play(); }catch(e){}
  }

  /* ========= LEVEL CONFIG ========= */
  const LEVELS = {
    EASY:   { gravity:0.42, jump:-7.5, gap:200, speed:1.8 },
    NORMAL: { gravity:0.45, jump:-7,   gap:180, speed:2.0 },
    HARD:   { gravity:0.5,  jump:-6.5, gap:150, speed:2.3 }
  };

  let level = "NORMAL";

  const W = canvas.width;
  const H = canvas.height;
  const PIPE_WIDTH = 52;

  /* ========= STATE ========= */
  const State = { MENU:0, PLAY:1, DEAD:2 };
  let state = State.MENU;

  let bird, pipes, score, best, frame;
  best = Number(localStorage.getItem("best_flappy_chudung") || 0);

  function resetGame(){
    bird = { x:110, y:240, vy:0, size:40 };
    pipes = [];
    score = 0;
    frame = 0;
    state = State.PLAY;
  }

  function spawnPipe(){
    const top = Math.random()*220 + 70;
    pipes.push({ x:W+10, top, passed:false });
  }

  function die(){
    if(state===State.DEAD) return;
    state = State.DEAD;
    playSound(sndHit);

    if(score > best){
      best = score;
      localStorage.setItem("best_flappy_chudung", best);
    }
  }

  function flap(){
    if(state===State.MENU){
      resetGame();
      bird.vy = LEVELS[level].jump;
      playSound(sndFlap);
      return;
    }
    if(state===State.DEAD){
      resetGame();
      bird.vy = LEVELS[level].jump;
      playSound(sndFlap);
      return;
    }
    bird.vy = LEVELS[level].jump;
    playSound(sndFlap);
  }

  /* ========= INPUT ========= */
  window.addEventListener("keydown", e=>{
    if(e.code==="Space"){ e.preventDefault(); flap(); }
    if(e.key==="1") level="EASY";
    if(e.key==="2") level="NORMAL";
    if(e.key==="3") level="HARD";
    if(e.key==="S" && state===State.DEAD) shareScore();
  });
  window.addEventListener("mousedown", flap);
  window.addEventListener("touchstart", e=>{
    e.preventDefault(); flap();
  },{passive:false});

  /* ========= UPDATE ========= */
  function update(){
    if(state===State.MENU) return;

    if(state===State.DEAD){
      bird.vy += LEVELS[level].gravity;
      bird.y += bird.vy;
      if(bird.y + bird.size > H){
        bird.y = H - bird.size;
        bird.vy = 0;
      }
      return;
    }

    frame++;

    bird.vy += LEVELS[level].gravity;
    bird.y += bird.vy;

    if(frame % 140 === 0) spawnPipe();

    for(const p of pipes){
      p.x -= LEVELS[level].speed;

      if(!p.passed && p.x + PIPE_WIDTH < bird.x){
        p.passed = true;
        score++;
        playSound(sndPoint);
      }

      const hitX = bird.x + bird.size > p.x && bird.x < p.x + PIPE_WIDTH;
      const hitY = bird.y < p.top || bird.y + bird.size > p.top + LEVELS[level].gap;
      if(hitX && hitY) die();
    }

    pipes = pipes.filter(p=>p.x + PIPE_WIDTH > -30);

    if(bird.y + bird.size > H) die();
  }

  /* ========= DRAW ========= */
  function drawBird(){
    ctx.save();
    ctx.beginPath();
    ctx.arc(
      bird.x + bird.size/2,
      bird.y + bird.size/2,
      bird.size/2,
      0, Math.PI*2
    );
    ctx.clip();
    ctx.drawImage(
      logoImg,
      bird.x,
      bird.y,
      bird.size,
      bird.size
    );
    ctx.restore();
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    // Pipes
    for(const p of pipes){
      ctx.save();
      ctx.translate(p.x+PIPE_WIDTH, p.top);
      ctx.rotate(Math.PI);
      ctx.drawImage(pipeImg,0,0,PIPE_WIDTH,p.top);
      ctx.restore();

      ctx.drawImage(pipeImg,p.x,p.top+LEVELS[level].gap,PIPE_WIDTH,H);
    }

    if(bird) drawBird();

    // HUD
    ctx.fillStyle="#000";
    ctx.font="20px Arial";
    ctx.fillText("Score: "+score,10,30);
    ctx.font="14px Arial";
    ctx.fillText("Best: "+best,10,50);
    ctx.fillText("Level: "+level,300,30);

    // Watermark
    ctx.font="16px 'Segoe Script','Comic Sans MS',cursive";
    ctx.textAlign="right";
    ctx.fillText("Ch√∫ D≈©ng Decor",390,585);
    ctx.textAlign="left";

    if(state===State.MENU){
      ctx.font="18px Arial";
      ctx.fillText("1: Easy   2: Normal   3: Hard",80,280);
      ctx.fillText("Tap / Space ƒë·ªÉ b·∫Øt ƒë·∫ßu",105,320);
    }

    if(state===State.DEAD){
      ctx.font="22px Arial";
      ctx.fillText("GAME OVER",135,270);
      ctx.font="16px Arial";
      ctx.fillText("Tap / Space ƒë·ªÉ ch∆°i l·∫°i",95,305);
      ctx.fillText("Nh·∫•n S ƒë·ªÉ chia s·∫ª ƒëi·ªÉm",105,335);
    }
  }

  /* ========= SHARE SCORE ========= */
  function shareScore(){
    const text =
`üéÆ Flappy Ch√∫ D≈©ng Decor
üèÜ ƒêi·ªÉm c·ªßa t√¥i: ${score}
üî• Level: ${level}

B·∫°n th·ª≠ ph√° k·ª∑ l·ª•c xem!`;

    if(navigator.share){
      navigator.share({ text });
    }else{
      navigator.clipboard.writeText(text);
      alert("ƒê√£ copy ƒëi·ªÉm ‚Äì g·ª≠i cho b·∫°n b√® nh√©!");
    }
  }

  /* ========= LOOP ========= */
  function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
})();
</script>
</body>
</html>
