<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flappy Chú Dũng Decor</title>

<style>
  body{
    margin:0;
    background:#111;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Arial, sans-serif;
  }
  canvas{
    background:#70c5ce;
    border-radius:12px;
  }
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== LOGO (THAY LINK LOGO CỦA BẠN) ===== */
const birdImg = new Image();
birdImg.src = "https://i.imgur.com/8QfQ9ZC.png";

/* ===== PIPE ===== */
const pipeImg = new Image();
pipeImg.src =
  "https://raw.githubusercontent.com/sourabhv/FlapPyBird/master/assets/sprites/pipe-green.png";

/* ===== LEVEL ===== */
const LEVELS = {
  EASY:   { gravity:0.4,  jump:-7.5, gap:220, speed:1.6 },
  NORMAL: { gravity:0.45, jump:-7,   gap:190, speed:1.9 },
  HARD:   { gravity:0.5,  jump:-6.5, gap:160, speed:2.2 }
};
let level = "NORMAL";

/* ===== GAME VAR ===== */
const W = canvas.width;
const H = canvas.height;
const PIPE_W = 52;

let bird, pipes, score, best, frame;
let state = "MENU";

best = Number(localStorage.getItem("best_flappy_chudung") || 0);

/* ===== RESET ===== */
function reset(){
  bird = { x:100, y:250, v:0, size:38 };
  pipes = [];
  score = 0;
  frame = 0;
  state = "PLAY";
}

/* ===== INPUT ===== */
function flap(){
  if(state === "MENU" || state === "DEAD"){
    reset();
  }
  bird.v = LEVELS[level].jump;
}

document.addEventListener("keydown", e=>{
  if(e.code === "Space") flap();
  if(e.key === "1") level = "EASY";
  if(e.key === "2") level = "NORMAL";
  if(e.key === "3") level = "HARD";
});
document.addEventListener("mousedown", flap);

/* ===== PIPE ===== */
function spawnPipe(){
  const top = Math.random()*220 + 60;
  pipes.push({ x:W, top, passed:false });
}

/* ===== UPDATE ===== */
function update(){
  if(state !== "PLAY") return;

  frame++;
  bird.v += LEVELS[level].gravity;
  bird.y += bird.v;

  if(frame % 150 === 0) spawnPipe();

  for(const p of pipes){
    p.x -= LEVELS[level].speed;

    if(!p.passed && p.x + PIPE_W < bird.x){
      p.passed = true;
      score++;
    }

    const hitX = bird.x + bird.size > p.x && bird.x < p.x + PIPE_W;
    const hitY =
      bird.y < p.top ||
      bird.y + bird.size > p.top + LEVELS[level].gap;

    if(hitX && hitY){
      state = "DEAD";
      if(score > best){
        best = score;
        localStorage.setItem("best_flappy_chudung", best);
      }
    }
  }

  pipes = pipes.filter(p => p.x + PIPE_W > 0);

  if(bird.y + bird.size > H){
    state = "DEAD";
  }
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,W,H);

  // pipes
  for(const p of pipes){
    ctx.save();
    ctx.translate(p.x + PIPE_W, p.top);
    ctx.rotate(Math.PI);
    ctx.drawImage(pipeImg,0,0,PIPE_W,p.top);
    ctx.restore();

    ctx.drawImage(
      pipeImg,
      p.x,
      p.top + LEVELS[level].gap,
      PIPE_W,
      H
    );
  }

  // bird (logo)
  if(bird){
    ctx.save();
    ctx.beginPath();
    ctx.arc(
      bird.x + bird.size/2,
      bird.y + bird.size/2,
      bird.size/2,
      0, Math.PI*2
    );
    ctx.clip();
    ctx.drawImage(birdImg, bird.x, bird.y, bird.size, bird.size);
    ctx.restore();
  }

  // HUD
  ctx.fillStyle="#000";
  ctx.font="18px Arial";
  ctx.fillText("Score: "+score,10,30);
  ctx.font="14px Arial";
  ctx.fillText("Best: "+best,10,50);
  ctx.fillText("Level: "+level,290,30);

  // watermark
  ctx.textAlign="right";
  ctx.font="16px cursive";
  ctx.fillText("Chú Dũng Decor",390,585);
  ctx.textAlign="left";

  if(state === "MENU"){
    ctx.fillText("1 Easy   2 Normal   3 Hard",90,280);
    ctx.fillText("Click / Space để chơi",120,320);
  }

  if(state === "DEAD"){
    ctx.fillText("GAME OVER",135,280);
    ctx.fillText("Click / Space để chơi lại",95,320);
  }
}

/* ===== LOOP ===== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
